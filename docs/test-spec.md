# RakuWallet テスト仕様書

**システム名**: RakuWallet（入院患者お小遣い管理システム）
**バージョン**: 1.0.0
**作成日**: 2026-02-17

---

## 1. テスト対象機能一覧

| 機能ID | 機能名 | 画面/エンドポイント |
|--------|--------|-------------------|
| F-01 | ダッシュボード | `/` |
| F-02 | 患者管理 - 一覧 | `/patients` |
| F-03 | 患者管理 - 登録 | `/patients`（モーダル） |
| F-04 | 患者管理 - 編集 | `/patients`（モーダル） |
| F-05 | 患者管理 - 退院処理 | `/patients`（ダイアログ） |
| F-06 | 入出金記録 - 一覧 | `/transactions` |
| F-07 | 入出金記録 - 登録 | `/transactions`（モーダル） |
| F-08 | 月次出納帳 | `/ledger` |
| F-09 | 月末残高一覧 | `/balances` |
| F-10 | 患者一覧API | `GET /api/patients` |
| F-11 | 患者登録API | `POST /api/patients` |
| F-12 | 患者更新API | `PUT /api/patients/[id]` |
| F-13 | 取引一覧API | `GET /api/transactions` |
| F-14 | 取引登録API | `POST /api/transactions` |
| F-15 | 残高一覧API | `GET /api/balances` |
| F-16 | ダッシュボードAPI | `GET /api/dashboard` |

---

## 2. テストケース一覧

### 凡例

- **種別**: 正常系 / 異常系 / 境界値
- **優先度**: 高 / 中 / 低

---

### F-01: ダッシュボード

#### TC-DASH-001: 初期表示 - サマリーカード表示

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-001 |
| テスト名 | ダッシュボード初期表示 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | シードデータが投入済み（患者5名・取引データあり） |
| **手順** | 1. ブラウザで `http://localhost:3000/` を開く |
| **期待値** | ・「ダッシュボード」タイトルが表示される<br>・「在院患者数」カードに `5名` が表示される<br>・「預かり金 総残高」カードに金額（例: `¥125,000`）が表示される<br>・「今月の入金合計」カードに当月入金合計が表示される<br>・「今月の出金合計」カードに当月出金合計が表示される<br>・「最近の取引」セクションに最大10件の取引履歴が表示される |

---

#### TC-DASH-002: 取引履歴の表示項目確認

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-002 |
| テスト名 | 最近の取引履歴の表示項目確認 |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 取引データが1件以上存在する |
| **手順** | 1. ダッシュボードを開く<br>2. 「最近の取引」セクションを確認する |
| **期待値** | 各取引行に以下が表示される:<br>・日付（例: `2025/01/15`）<br>・患者番号（例: `P0001`）<br>・患者名（例: `山田太郎`）<br>・摘要（例: `小遣い入金`）<br>・入金額または出金額（入金: 緑色、出金: 赤色で表示）<br>・入金の場合は出金列が `-`、出金の場合は入金列が `-` |

---

#### TC-DASH-003: 取引データなし

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-003 |
| テスト名 | 取引データが存在しない場合の表示 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | DBが空（取引データ0件） |
| **手順** | 1. ダッシュボードを開く |
| **期待値** | ・在院患者数: `0名`<br>・預かり金 総残高: `¥0`<br>・今月の入金合計: `¥0`<br>・今月の出金合計: `¥0`<br>・「最近の取引」に「取引データがありません」などのメッセージが表示される（またはリスト空） |

---

#### TC-DASH-004: ローディング状態

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-004 |
| テスト名 | データ取得中のローディング表示 |
| 種別 | 正常系 |
| 優先度 | 低 |
| **前提条件** | ページ初回アクセス時 |
| **手順** | 1. ダッシュボードにアクセスする<br>2. 表示が完了する前の状態を観察する |
| **期待値** | ・データ取得中はローディングスピナー（CircularProgress）が表示される<br>・データ取得完了後にコンテンツが表示される |

---

#### TC-DASH-005: レイアウト - AppBar・サイドバー

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-005 |
| テスト名 | AppBarとサイドバーの重なりなし |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | なし |
| **手順** | 1. ダッシュボードを開く<br>2. 画面レイアウトを目視確認する |
| **期待値** | ・左サイドバー（幅260px）が固定表示される<br>・AppBarがサイドバーに重ならず、右側コンテンツ領域の上部に表示される<br>・「RakuWallet」のタイトルがAppBarに表示される<br>・サイドバーに「RakuWallet」ロゴと「入院患者お小遣い管理システム」サブタイトルが表示される |

---

#### TC-DASH-006: ナビゲーション - サイドバーメニュー

| 項目 | 内容 |
|------|------|
| テストID | TC-DASH-006 |
| テスト名 | サイドバーメニューからの画面遷移 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | なし |
| **手順** | 1. サイドバーの各メニュー項目をクリックする<br>　a. 「ダッシュボード」<br>　b. 「患者管理」<br>　c. 「入出金記録」<br>　d. 「月次出納帳」<br>　e. 「月末残高一覧」 |
| **期待値** | 各項目クリック後:<br>　a. `/` に遷移し、「ダッシュボード」タイトル表示<br>　b. `/patients` に遷移し、「患者管理」タイトル表示<br>　c. `/transactions` に遷移し、「入出金記録」タイトル表示<br>　d. `/ledger` に遷移し、「月次出納帳」タイトル表示<br>　e. `/balances` に遷移し、「月末残高一覧」タイトル表示<br>・現在ページのメニュー項目がハイライト（selected状態）表示される |

---

### F-02〜F-05: 患者管理

#### TC-PAT-001: 患者一覧の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-001 |
| テスト名 | 患者一覧の基本表示 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | シードデータ投入済み（患者5名） |
| **手順** | 1. `/patients` を開く |
| **期待値** | ・テーブルヘッダー: 患者番号 / 患者名 / フリガナ / 病棟 / 病室 / 入院日 / 状態 / 操作<br>・5行の患者データが表示される<br>・各行に「編集」ボタンと「退院」ボタンが表示される<br>・在院中患者のバッジ: 緑色「在院中」<br>・退院済患者のバッジ: グレー「退院済」 |

---

#### TC-PAT-002: 患者新規登録 - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-002 |
| テスト名 | 患者の新規登録（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 患者管理画面が表示されている |
| **手順** | 1. 「新規患者登録」ボタンをクリックする<br>2. 以下を入力する:<br>　- 患者番号: `P0099`<br>　- 患者名: `テスト　次郎`<br>　- フリガナ: `テスト ジロウ`<br>　- 病棟: `第一病棟`<br>　- 病室: `101`<br>　- 入院日: `2026-02-01`<br>3. 「登録」ボタンをクリックする |
| **期待値** | ・モーダルが閉じる<br>・患者一覧に `P0099 テスト　次郎` が追加表示される<br>・状態バッジが「在院中」（緑）で表示される<br>・入院日が `2026/02/01` と表示される |

---

#### TC-PAT-003: 患者新規登録 - 必須項目未入力

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-003 |
| テスト名 | 必須項目未入力での登録エラー |
| 種別 | 異常系 |
| 優先度 | 高 |
| **前提条件** | 患者登録モーダルが開いている |
| **手順** | 1. 患者番号のみ入力し、患者名を空欄のまま<br>2. 「登録」ボタンをクリックする |
| **期待値** | ・エラーメッセージが表示される（例: 「患者名は必須です」）<br>・モーダルが閉じない<br>・DBに不正なデータが登録されない |

---

#### TC-PAT-004: 患者番号の重複チェック

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-004 |
| テスト名 | 既存患者番号での登録エラー |
| 種別 | 異常系 |
| 優先度 | 高 |
| **前提条件** | `P0001` の患者が既に登録されている |
| **手順** | 1. 患者登録モーダルを開く<br>2. 患者番号に `P0001` を入力し、他項目も入力する<br>3. 「登録」ボタンをクリックする |
| **期待値** | ・エラーメッセージが表示される（例: 「この患者番号は既に使用されています」）<br>・モーダルが閉じない<br>・重複データがDBに登録されない |

---

#### TC-PAT-005: 患者情報の編集

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-005 |
| テスト名 | 患者情報の編集（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 患者一覧に患者が1名以上存在する |
| **手順** | 1. 任意の患者行の「編集」ボタンをクリックする<br>2. 病室を `202` に変更する<br>3. 「更新」ボタンをクリックする |
| **期待値** | ・モーダルが閉じる<br>・一覧の当該患者の病室が `202` に更新される<br>・他の項目（患者番号・患者名等）は変更されない |

---

#### TC-PAT-006: 退院処理

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-006 |
| テスト名 | 患者の退院処理 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 在院中の患者が1名以上存在する |
| **手順** | 1. 在院中患者の「退院」ボタンをクリックする<br>2. 確認ダイアログが表示されることを確認する<br>3. 「確認」または「退院する」ボタンをクリックする |
| **期待値** | ・ダイアログが閉じる<br>・当該患者の状態バッジが「退院済」（グレー）に変わる<br>・「退院」ボタンが無効化またはグレーアウトされる |

---

#### TC-PAT-007: 退院処理キャンセル

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-007 |
| テスト名 | 退院処理の確認ダイアログでキャンセル |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 在院中の患者が1名以上存在する |
| **手順** | 1. 在院中患者の「退院」ボタンをクリックする<br>2. 確認ダイアログで「キャンセル」をクリックする |
| **期待値** | ・ダイアログが閉じる<br>・患者の状態は「在院中」のまま変化しない<br>・DBのデータに変更なし |

---

#### TC-PAT-008: 患者一覧 - データなし

| 項目 | 内容 |
|------|------|
| テストID | TC-PAT-008 |
| テスト名 | 患者データが0件の場合の表示 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | DBに患者データが存在しない |
| **手順** | 1. `/patients` を開く |
| **期待値** | ・テーブルヘッダーは表示される<br>・テーブル本体に「患者データがありません」などの空状態メッセージが表示される<br>・エラーは発生しない |

---

### F-06〜F-07: 入出金記録

#### TC-TXN-001: 取引一覧の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-001 |
| テスト名 | 取引一覧の基本表示 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | シードデータ投入済み（取引データあり） |
| **手順** | 1. `/transactions` を開く |
| **期待値** | ・テーブルヘッダー: 日付 / 患者番号 / 患者名 / 種別 / 摘要 / 金額<br>・取引データが一覧表示される（日付降順）<br>・入金行の種別バッジ: 緑色「入金」<br>・出金行の種別バッジ: 赤色「出金」<br>・金額列: 入金は緑色、出金は赤色で表示 |

---

#### TC-TXN-002: 入金登録 - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-002 |
| テスト名 | 入金取引の登録（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 在院中患者が1名以上存在する |
| **手順** | 1. 「入出金記録」を開く<br>2. 「入出金登録」ボタンをクリックする<br>3. 以下を入力する:<br>　- 患者: `P0001 - 山田太郎`（ドロップダウンから選択）<br>　- 種別: 「入金」を選択<br>　- 金額: `10000`<br>　- 摘要: `小遣い入金`<br>　- 日付: `2026-02-10`<br>4. 「登録」ボタンをクリックする |
| **期待値** | ・モーダルが閉じる<br>・取引一覧の先頭（最新）に新しい行が追加される<br>・追加行: 日付=`2026/02/10`、患者番号=`P0001`、患者名=`山田太郎`、種別=「入金」（緑）、摘要=`小遣い入金`、金額=`¥10,000`（緑） |

---

#### TC-TXN-003: 出金登録 - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-003 |
| テスト名 | 出金取引の登録（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 在院中患者が1名以上、当該患者の残高が1,000円以上存在する |
| **手順** | 1. 「入出金記録」を開く<br>2. 「入出金登録」ボタンをクリックする<br>3. 以下を入力する:<br>　- 患者: `P0001 - 山田太郎`<br>　- 種別: 「出金」を選択<br>　- 金額: `1000`<br>　- 摘要: `日用品購入`<br>　- 日付: `2026-02-10`<br>4. 「登録」ボタンをクリックする |
| **期待値** | ・モーダルが閉じる<br>・一覧に出金行が追加される<br>・種別=「出金」（赤）、金額=`¥1,000`（赤）で表示される |

---

#### TC-TXN-004: 金額に0または負数を入力

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-004 |
| テスト名 | 無効な金額での登録エラー |
| 種別 | 異常系 |
| 優先度 | 高 |
| **前提条件** | 取引登録モーダルが開いている |
| **手順** | 1. 金額に `0` を入力する<br>2. 「登録」ボタンをクリックする<br>3. 次に金額に `-1000` を入力して再試行する |
| **期待値** | ・エラーメッセージが表示される（例: 「金額は1円以上を入力してください」）<br>・モーダルが閉じない<br>・DBに不正データが登録されない |

---

#### TC-TXN-005: 患者未選択での登録

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-005 |
| テスト名 | 患者を選択せずに登録エラー |
| 種別 | 異常系 |
| 優先度 | 中 |
| **前提条件** | 取引登録モーダルが開いている |
| **手順** | 1. 患者を選択せずに金額・摘要・日付を入力する<br>2. 「登録」ボタンをクリックする |
| **期待値** | ・エラーメッセージが表示される（例: 「患者を選択してください」）<br>・モーダルが閉じない |

---

#### TC-TXN-006: 金額の上限値

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-006 |
| テスト名 | 大きな金額の登録 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | 在院中患者が存在する |
| **手順** | 1. 取引登録モーダルを開く<br>2. 金額に `999999999` を入力する<br>3. 「登録」ボタンをクリックする |
| **期待値** | ・正常に登録される（または上限値エラーが表示される）<br>・一覧に `¥999,999,999` が正しくフォーマットされて表示される |

---

#### TC-TXN-007: 取引一覧 - データなし

| 項目 | 内容 |
|------|------|
| テストID | TC-TXN-007 |
| テスト名 | 取引データが0件の場合 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | DBに取引データが存在しない |
| **手順** | 1. `/transactions` を開く |
| **期待値** | ・テーブルが空状態で表示される（エラーなし）<br>・空状態メッセージが表示される |

---

### F-08: 月次出納帳

#### TC-LED-001: 当月出納帳の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-001 |
| テスト名 | 月次出納帳の基本表示 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 当月（2026年2月）の取引データが存在する |
| **手順** | 1. `/ledger` を開く<br>2. 年=`2026`、月=`2` が選択された状態を確認する |
| **期待値** | ・テーブルヘッダー: 日付 / 患者番号 / 患者名 / 摘要 / 入金 / 出金 / 差引残高<br>・取引が日付昇順に表示される<br>・入金金額は緑色、出金金額は赤色で表示<br>・差引残高は行ごとに累計計算される（例: 前行残高 + 入金 - 出金）<br>・テーブル最下部「合計」行に月間入金合計・出金合計・最終残高が表示される |

---

#### TC-LED-002: 差引残高の累計計算

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-002 |
| テスト名 | 差引残高の正確な累計計算 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 以下の取引データが2026年2月に存在する（全患者合算）:<br>　1行目: 入金 ¥30,000<br>　2行目: 入金 ¥20,000<br>　3行目: 出金 ¥5,000 |
| **手順** | 1. `/ledger` を開き、2026年2月を選択する |
| **期待値** | ・1行目の差引残高: `¥30,000`<br>・2行目の差引残高: `¥50,000`<br>・3行目の差引残高: `¥45,000`<br>・合計行: 入金=`¥50,000`、出金=`¥5,000`、残高=`¥45,000`<br>・サマリーカード: 入金合計=`¥50,000`、出金合計=`¥5,000`、当月差引=`¥45,000` |

---

#### TC-LED-003: 患者絞り込み

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-003 |
| テスト名 | 患者ドロップダウンによる絞り込み |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 複数患者の取引データが当月に存在する |
| **手順** | 1. 出納帳を開く<br>2. 患者ドロップダウンから `P0001 - 山田太郎` を選択する |
| **期待値** | ・表示が `山田太郎` の取引のみに絞り込まれる<br>・他の患者の取引が表示されない<br>・差引残高・合計は山田太郎の取引のみで計算される |

---

#### TC-LED-004: 別月への切り替え

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-004 |
| テスト名 | 年月の変更による表示切り替え |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 2026年1月の取引データが存在する |
| **手順** | 1. 出納帳を開く（デフォルト: 2026年2月）<br>2. 月ドロップダウンで `1月` を選択する |
| **期待値** | ・2026年1月の取引のみが表示される<br>・2月の取引は表示されない<br>・サマリーカードに「2026年1月 入金合計」等と表示される |

---

#### TC-LED-005: 取引なし月の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-005 |
| テスト名 | 取引が存在しない月を選択 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | 選択した年月に取引データが存在しない |
| **手順** | 1. 出納帳を開く<br>2. 取引のない月（例: 2024年1月）を選択する |
| **期待値** | ・「2024年1月の取引データがありません」のメッセージが表示される<br>・合計行は表示されない<br>・サマリーカード: 入金合計=`¥0`、出金合計=`¥0`、当月差引=`¥0` |

---

#### TC-LED-006: 「全患者」選択時の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-LED-006 |
| テスト名 | 患者ドロップダウンで「全患者」を選択 |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 複数患者の取引データが存在する |
| **手順** | 1. 特定患者で絞り込んだ後<br>2. 患者ドロップダウンで「全患者」を選択する |
| **期待値** | ・全患者の取引が表示される<br>・差引残高は全取引の累計で再計算される |

---

### F-09: 月末残高一覧

#### TC-BAL-001: 月末残高一覧の表示

| 項目 | 内容 |
|------|------|
| テストID | TC-BAL-001 |
| テスト名 | 月末残高一覧の基本表示 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 当月（2026年2月）の取引データが存在する |
| **手順** | 1. `/balances` を開く |
| **期待値** | ・テーブルヘッダー: 患者番号 / 患者名 / 病棟 / 病室 / 当月入金 / 当月出金 / 月末残高<br>・全患者のデータが表示される（退院患者も含む場合あり）<br>・「預かり金 総残高」カードに全患者残高合計が表示される<br>・「合計」行に患者人数と合計値が表示される |

---

#### TC-BAL-002: 残高の正確性

| 項目 | 内容 |
|------|------|
| テストID | TC-BAL-002 |
| テスト名 | 月末残高の正確な計算 |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | P0001（山田太郎）の2026年1月以前の累計入金が `¥50,000`、累計出金が `¥15,000`、<br>2026年2月入金が `¥10,000`、2026年2月出金が `¥5,000` のデータが存在する |
| **手順** | 1. `/balances` を開き、2026年2月を選択する |
| **期待値** | P0001行の値:<br>・当月入金: `¥10,000`<br>・当月出金: `¥5,000`<br>・月末残高: `¥40,000`（累計入金60,000 - 累計出金20,000） |

---

#### TC-BAL-003: 残高がマイナスの患者

| 項目 | 内容 |
|------|------|
| テストID | TC-BAL-003 |
| テスト名 | 残高マイナス患者の視覚的表示 |
| 種別 | 境界値 |
| 優先度 | 中 |
| **前提条件** | 出金合計が入金合計を上回っている患者が存在する |
| **手順** | 1. `/balances` を開く<br>2. 残高がマイナスの患者行を確認する |
| **期待値** | ・当該患者の月末残高がマイナス値（例: `-¥500`）で赤色表示される<br>・他の患者は通常（黒色）表示 |

---

#### TC-BAL-004: 別月への切り替え

| 項目 | 内容 |
|------|------|
| テストID | TC-BAL-004 |
| テスト名 | 年月の変更による残高切り替え |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 複数月の取引データが存在する |
| **手順** | 1. `/balances` を開く（2026年2月）<br>2. 月を `1月` に変更する |
| **期待値** | ・表示が2026年1月末時点の残高に切り替わる<br>・「当月入金」「当月出金」が1月分の値に変わる<br>・「預かり金 総残高」が1月末時点の合計になる |

---

#### TC-BAL-005: データなし

| 項目 | 内容 |
|------|------|
| テストID | TC-BAL-005 |
| テスト名 | 取引データなし月の表示 |
| 種別 | 境界値 |
| 優先度 | 低 |
| **前提条件** | 選択した年月以前の取引データが存在しない |
| **手順** | 1. 取引のない月を選択する |
| **期待値** | ・テーブルに「データがありません」と表示される<br>・サマリーカード: 総残高=`¥0`、入金合計=`¥0`、出金合計=`¥0` |

---

### F-10〜F-16: API テスト

#### TC-API-001: GET /api/patients - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-API-001 |
| テスト名 | 患者一覧取得API（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | DBに患者データが存在する |
| **手順** | `GET /api/patients` にリクエストを送信する |
| **期待値** | ・HTTPステータス: `200 OK`<br>・レスポンス形式: JSON配列<br>・各要素に `id`, `patientCode`, `name`, `kana`, `wardName`, `roomNumber`, `admissionDate`, `isActive` が含まれる<br>・例: `[{"id":"...","patientCode":"P0001","name":"山田太郎",...}]` |

---

#### TC-API-002: POST /api/patients - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-API-002 |
| テスト名 | 患者登録API（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | `P0099` の患者番号が未使用 |
| **手順** | `POST /api/patients` に以下のJSONボディを送信:<br>`{"patientCode":"P0099","name":"テスト次郎","kana":"テストジロウ","wardName":"第一病棟","roomNumber":"101","admissionDate":"2026-02-01"}` |
| **期待値** | ・HTTPステータス: `201 Created`<br>・レスポンス: 作成された患者オブジェクト（`id`, `patientCode`, `name` 等を含む）<br>・`isActive`: `true` |

---

#### TC-API-003: POST /api/patients - 必須項目欠如

| 項目 | 内容 |
|------|------|
| テストID | TC-API-003 |
| テスト名 | 必須項目欠如での患者登録エラー |
| 種別 | 異常系 |
| 優先度 | 高 |
| **前提条件** | なし |
| **手順** | `POST /api/patients` に不完全なJSONを送信:<br>`{"patientCode":"P0099"}` |
| **期待値** | ・HTTPステータス: `400 Bad Request` または `500`<br>・レスポンスに `error` フィールドが含まれる |

---

#### TC-API-004: GET /api/transactions - 月フィルタ

| 項目 | 内容 |
|------|------|
| テストID | TC-API-004 |
| テスト名 | 取引一覧のフィルタリング |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 複数月の取引データが存在する |
| **手順** | `GET /api/transactions?year=2026&month=2` にリクエスト送信 |
| **期待値** | ・HTTPステータス: `200 OK`<br>・レスポンス: 2026年2月の取引のみを含むJSON配列<br>・各要素に `id`, `type`, `amount`, `description`, `date`, `patient`（`name`, `patientCode`）が含まれる<br>・他月のデータが混入しない |

---

#### TC-API-005: GET /api/transactions - 患者フィルタ

| 項目 | 内容 |
|------|------|
| テストID | TC-API-005 |
| テスト名 | 特定患者の取引絞り込み |
| 種別 | 正常系 |
| 優先度 | 中 |
| **前提条件** | 複数患者の取引データが存在する |
| **手順** | `GET /api/transactions?year=2026&month=2&patientId={P0001のID}` にリクエスト送信 |
| **期待値** | ・P0001の取引のみが返される<br>・他患者の取引が含まれない |

---

#### TC-API-006: GET /api/balances - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-API-006 |
| テスト名 | 月末残高API（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 取引データが存在する |
| **手順** | `GET /api/balances?year=2026&month=2` にリクエスト送信 |
| **期待値** | ・HTTPステータス: `200 OK`<br>・レスポンス:<br>`{"year":2026,"month":2,"monthEnd":"2026-02-28","totalBalance":N,"totalDeposit":N,"totalWithdrawal":N,"balances":[{"patientId":"...","patientCode":"P0001","name":"山田太郎","wardName":"第一病棟","roomNumber":"101","balance":N,"monthDeposit":N,"monthWithdrawal":N},...]}`<br>・`monthEnd` が `2026-02-28`（うるう年でない場合）になっている |

---

#### TC-API-007: GET /api/dashboard - 正常

| 項目 | 内容 |
|------|------|
| テストID | TC-API-007 |
| テスト名 | ダッシュボードAPI（正常系） |
| 種別 | 正常系 |
| 優先度 | 高 |
| **前提条件** | 患者・取引データが存在する |
| **手順** | `GET /api/dashboard` にリクエスト送信 |
| **期待値** | ・HTTPステータス: `200 OK`<br>・レスポンス:<br>`{"activePatients":N,"totalBalance":N,"monthDeposit":N,"monthWithdrawal":N,"recentTransactions":[...]}`<br>・`recentTransactions` は最大10件<br>・各取引に `id`, `type`, `amount`, `description`, `date`, `patient` が含まれる |

---

#### TC-API-008: APIエラーレスポンス形式

| 項目 | 内容 |
|------|------|
| テストID | TC-API-008 |
| テスト名 | サーバーエラー時のレスポンス形式 |
| 種別 | 異常系 |
| 優先度 | 中 |
| **前提条件** | DBが利用不可な状態を模擬する（または不正なクエリを送る） |
| **手順** | 各APIエンドポイントへ意図的にエラーを引き起こすリクエストを送信する |
| **期待値** | ・HTTPステータス: `500 Internal Server Error`<br>・レスポンス形式: `{"error": "エラーメッセージ"}`<br>・空のレスポンスボディではない（JSONパースエラーを防ぐ） |

---

#### TC-API-009: うるう年の月末日

| 項目 | 内容 |
|------|------|
| テストID | TC-API-009 |
| テスト名 | うるう年2月の月末日計算 |
| 種別 | 境界値 |
| 優先度 | 中 |
| **前提条件** | 2024年2月の取引データが存在する |
| **手順** | `GET /api/balances?year=2024&month=2` にリクエスト送信 |
| **期待値** | ・`monthEnd`: `2024-02-29`（2024年はうるう年のため29日） |

---

## 3. テスト実施環境

| 項目 | 内容 |
|------|------|
| OS | Linux（WSL2） / macOS |
| Node.js | 22.x 以上 |
| ブラウザ | Google Chrome 最新版 |
| DB | SQLite（dev.db） |
| テストデータ | `npm run db:seed` で投入済み |
| 起動コマンド | `npm run dev`（開発環境） |

## 4. テスト前準備

```bash
# 1. 依存パッケージのインストール
npm install

# 2. DBスキーマ適用
npm run db:push

# 3. テストデータ投入
npm run db:seed

# 4. 開発サーバー起動
npm run dev
```

## 5. 集計

| 種別 | 件数 |
|------|------|
| 正常系 | 21件 |
| 異常系 | 9件 |
| 境界値 | 9件 |
| **合計** | **39件** |
